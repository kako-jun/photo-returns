# PhotoReturns: Take back your memories.

## プロジェクトの目的

Googleやアマゾンなどにバックアップされた写真を一括でスマホのSDカードにバックアップするツール

**写真をユーザー自身の手に取り戻す**

## 背景と問題意識

現代ではスマホで大量に写真をとれるようになった。
自動的にクラウドにアップされ、容量いっぱいになると課金を迫るモデルがOSベンダの常套になっている。
ITリテラシーの低い一般客はそれに逆らうことができない。
ファイルの実体が見えるとPCに移動され、自分でHDDにバックアップされてしまうため、ファイルも意識させないようにされている。

それに対抗するツールを作る。

**写真はユーザーのものだ。巨大企業のものではないので人質に取られたくない。**

## ユースケース

### 必須要件
- **クロスプラットフォーム**: Android, iOS, Windows, Linuxで動作
- **GUIアプリ**: コマンドライン不要、視覚的に操作できる
- **ローカルストレージ操作**:
  - デバイス内の指定フォルダや写真置き場の写真をリストアップ
  - リストを視覚的に表示
  - リネームして、同じデバイス内の別の場所にコピー保存
- **サーバー不要**: 各デバイス上で完結、ネットワーク通信不要

## 機能概要

このツールはスマホやPCから写真を収集し、日時でリネームし、`YYYY/YYYYMM/YYYYMMDD`の階層構造に自動的に分類する。
ユーザーが写真を集めるHDDなどにコピーしてマージして、蓄積していく。
そうやって保存した写真は各デバイスから消せるし、クラウドからも消せるため、容量いっぱいでなくなり、課金しなくて済む。

## アーキテクチャの検討

### 当初の誤解
当初は「スマホからPCサーバーに写真をアップロード」する構成を考えていたが、実際の要件は異なる。

### 実際の要件
各デバイス上で**ローカルに完結**するアプリが必要：
- Android端末上で → Android端末内のストレージを操作
- iOS端末上で → iOS端末内のストレージを操作
- Windows PC上で → Windows PC内のストレージを操作
- Linux PC上で → Linux PC内のストレージを操作

サーバーへのアップロードやネットワーク通信は不要。

## 技術スタック

### 元プロジェクト
- `D:\repos\2025\sandbox\y4m2d2`: 写真リネーム機能の完全実装（CLI版）
  - EXIF情報読み取り、日時ベースリネーム、階層整理機能が実装済み
  - **このコアロジックを再利用する**
- `D:\repos\2025\sandbox\rust-tool-template`: CLI/GUIハイブリッドテンプレート
  - 一部の設定管理やログ機能は参考にできる
- `D:\repos\2024\photos_into_YYYY_YYYYMM_YYYYMMDD`: Tauriテンプレート
  - Tauri 1.x（デスクトップのみ）

### 技術選定の候補

#### Option 1: Tauri 2.0（推奨）
**メリット:**
- ✅ Android/iOS/Windows/Linux/macOS 全対応
- ✅ Rustバックエンド → y4m2d2のコードを直接活用可能
- ✅ WebベースのUI（React/Vue/Svelte/HTML等）
- ✅ ローカルファイルシステムへのフルアクセス
- ✅ 軽量（Electronより小さい）

**デメリット:**
- ⚠️ Tauri 2.0はまだ比較的新しい（モバイル対応が安定しているか要確認）
- ⚠️ 各プラットフォームのビルド環境構築が必要

#### Option 2: Flutter
**メリット:**
- ✅ 全プラットフォーム対応実績が豊富
- ✅ モバイル開発に強い
- ✅ 成熟したエコシステム

**デメリット:**
- ❌ Dart言語 → y4m2d2のRustコードを移植する必要あり
- ❌ Rustの高速なファイル操作を活かせない

#### Option 3: React Native
**メリット:**
- ✅ モバイルに強い

**デメリット:**
- ❌ デスクトップ対応が弱い
- ❌ JavaScriptのみ → Rustコードを移植する必要あり

### 決定：Tauri 2.0を採用

**理由:**
- y4m2d2の既存Rustコードを最大限活用できる
- Android/iOS/デスクトップ全対応（Tauri 2.0の安定版で正式サポート）
- Webベースのフロントエンドで開発しやすい
- ファイル操作の高速性を維持
- 単一コードベースで全プラットフォームをカバー

**Tauri 2.0のモバイル対応について:**
- Tauri 2.0（安定版）は「The Mobile Update」と呼ばれる
- Android: Kotlinでネイティブコード統合可能
- iOS: Swiftでネイティブコード統合可能
- モバイルAPIサポート（通知、ダイアログ、ファイルシステム等）
- 開発体験はデスクトップほど成熟していないが、十分実用的

## 開発計画

### Phase 1: Tauri 2.0プロジェクトのセットアップ
1. **Tauri 2.0プロジェクトの初期化**
   - `npm create tauri-app`でプロジェクト作成
   - Android/iOSのモバイル対応設定
2. **プロジェクト構造の整理**
   - フロントエンド（HTML/CSS/JS または React等）
   - Rustバックエンド（src-tauri/）

### Phase 2: コアロジックの移植（y4m2d2 → Tauri）
1. **y4m2d2からコア機能をコピー**
   - EXIF読み取り（`kamadak-exif`）
   - 日時抽出ロジック
   - リネームロジック
   - 階層構造作成ロジック
2. **Tauriコマンドとして実装**
   - フロントエンドから呼び出せるようにする
   - `#[tauri::command]`属性を付与

### Phase 3: フロントエンドの実装
1. **写真リストUI（データグリッド形式）**
   - フォルダ選択ダイアログ
   - データグリッド形式で写真を一覧表示
     - 各行：1枚の画像
     - 列：サムネイル、元ファイル名、新ファイル名（プレビュー）、ステータス、進捗バー
   - チェックボックスで選択
2. **出力先設定UI**
   - 出力フォルダ選択
   - リネームルールの表示
3. **実行・進捗表示**
   - 実行ボタン
   - **画像ごとの進捗バー**（各行に表示、リネーム処理中に滑らかに伸びる）
   - 全体の進捗サマリー
   - 完了通知
4. **UIライブラリの候補**
   - データグリッド：AG Grid、TanStack Table、React Data Grid等
   - 進捗バー：カスタムCSS、または既存のプログレスコンポーネント

### Phase 4: プラットフォーム別ビルド・テスト
1. **Windows/Linuxでのテスト**
2. **Android APKビルド・テスト**
3. **iOS IPAビルド・テスト**（macOS必要）

## 実装上の考慮事項

### 写真のリネームルール
- EXIF撮影日時 > ファイル作成日時 > ファイル更新日時
- フォーマット: `YYYYMMDD_HHmmss.ext`
- 同名ファイルは `_01`, `_02` などの連番を追加

### 重複ファイルの処理
- ハッシュ値の比較で同一ファイルを検出
- 既存ファイルがある場合はスキップ

### セキュリティ
- ローカルネットワーク内での使用を想定
- 認証機能（オプション）
- ファイルサイズ制限
